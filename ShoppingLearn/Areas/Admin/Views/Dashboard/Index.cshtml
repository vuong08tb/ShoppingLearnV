
@{
    ViewData["title"] = "Dash board";

}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<h3>Dashboard Statistic</h3>

<div class="row">
    <div class="col-md-3">
        <div class="stat-box box-product">
            <div class="stat-content">
                <div class="stat-title">Sản phẩm</div>
                <div class="stat-value">@ViewBag.CountProduct</div>
            </div>
            <div class="stat-icon">
                <i class="fa-solid fa-box-open"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-box box-order">
            <div class="stat-content">
                <div class="stat-title">Đơn hàng</div>
                <div class="stat-value">@ViewBag.CountOrder</div>
            </div>
            <div class="stat-icon">
                <i class="fa-solid fa-shopping-cart"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-box box-category">
            <div class="stat-content">
                <div class="stat-title">Danh mục</div>
                <div class="stat-value">@ViewBag.CountCategory</div>
            </div>
            <div class="stat-icon">
                <i class="fa-solid fa-list"></i>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-box box-user">
            <div class="stat-content">
                <div class="stat-title">Người dùng</div>
                <div class="stat-value">@ViewBag.CountUser</div>
            </div>
            <div class="stat-icon">
                <i class="fa-solid fa-users"></i>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid"> <div class="row">
        <div class="col-md-12">
            <h4>Biểu đồ thống kê</h4>
            <div id="myfirstchart" style="height: 300px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);"></div>
        </div>
    </div>
</div>

@section Scripts{
    @* <script>
        $(document).ready(function () {
            var ChartMorris = new Morris.Line({
                       element: "myfirstchart",
                       data: [],
                       xkey:'date',
                       xLabelFormat: function (x){
                           return new Date(x).toLocaleDateString();
                       },
                       ykeys: ['sold','quantity','revenue','profit'],
                       labels:["Số lượng bán ra","Đơn hàng","Doanh thu","Lợi nhuận"]
                   });
            $.ajax({
               url:"@Url.Action("GetChartData","Dashboard")",
               type:"POST",
               dataType:"json",
               success: function (data){
                 if (data) {
                        ChartMorris.setData(data.map(function (item){
                             return{
                                    date : item.date,
                                    sold : item.sold,
                                    quantity : item.quantity,
                                    revenue: item.revenue,
                                    profit:item.profit

                               };
                           }));
                 } else{
                     console.warn("No data recevied for Morris chart update");
                     ChartMorris.setData([]);
                 }
                   
               },
               error: function(error) {
                   console.error("Error fetching data:",error);
               }
            });
            $('.filter-select').on('change',function () {
                var days = $(this).val();
                var endDate = new Date();
                var startDate = new Date(endDate.getTime() - days * 24 * 60 * 60 * 1000);

                $.ajax({
                    url: "@Url.Action("GetChartDataBySelect", "Dashboard")",
                    type: "POST",
                    dataType: "json",
                    data: {
                        startDate : startDate.toISOString().split('T')[0],
                        endDate: endDate.toISOString().split('T')[0]
                    },
                    success: function (data) {
                        if (data) {
                            ChartMorris.setData(data.map(function (item) {
                                return {
                                    date: item.date,
                                    sold: item.sold,
                                    quantity: item.quantity,
                                    revenue: item.revenue,
                                    profit: item.profit

                                };
                            }));
                        } else {
                            console.warn("No data recevied for Morris chart update");
                            ChartMorris.setData([]);
                        }

                    },
                    error: function (error) {
                        console.error("Error fetching data:", error);
                    }
                });
            });
        });
    </script> *@
    <script>
        $(document).ready(function () {
            var ChartMorris = new Morris.Line({
                element: "myfirstchart",
                data: [],
                xkey: 'date',
                xLabelFormat: function (x) {
                    return new Date(x).toLocaleDateString();
                },
                ykeys: ['totalQuantity', 'totalRevenue'],
                labels: ["Tổng số lượng", "Tổng doanh thu"]
            });

            // Load mặc định khi trang mở
            $.ajax({
                url: "@Url.Action("GetChartData", "Dashboard")",
                type: "POST",
                dataType: "json",
                success: function (data) {
                    if (data && data.length > 0) {
                        ChartMorris.setData(data.map(function (item) {
                            return {
                                date: item.date,
                                totalQuantity: item.totalQuantity,
                                totalRevenue: item.totalRevenue
                            };
                        }));
                    } else {
                        console.warn("No data received for Morris chart update");
                        ChartMorris.setData([]);
                    }
                },
                error: function (error) {
                    console.error("Error fetching data:", error);
                }
            });

            // Lọc theo ngày (ví dụ: 7 ngày, 30 ngày, 90 ngày)
            $('.filter-select').on('change', function () {
                var days = parseInt($(this).val());
                var endDate = new Date();
                var startDate = new Date(endDate.getTime() - days * 24 * 60 * 60 * 1000);

                $.ajax({
                    url: "@Url.Action("GetChartDataBySelect", "Dashboard")",
                    type: "POST",
                    dataType: "json",
                    data: {
                        startDate: startDate.toISOString().split('T')[0],
                        endDate: endDate.toISOString().split('T')[0]
                    },
                    success: function (data) {
                        if (data && data.length > 0) {
                            ChartMorris.setData(data.map(function (item) {
                                return {
                                    date: item.date,
                                    totalQuantity: item.totalQuantity,
                                    totalRevenue: item.totalRevenue
                                };
                            }));
                        } else {
                            console.warn("No data received for filtered Morris chart update");
                            ChartMorris.setData([]);
                        }
                    },
                    error: function (error) {
                        console.error("Error fetching filtered data:", error);
                    }
                });
            });
        });


    </script>
}
<style>
    /* Container chung cho các thẻ thống kê */
.stat-box {
    background: #fff;
    border-radius: 12px;
    padding: 25px 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin-bottom: 20px;
    border-left: 5px solid transparent; /* Viền màu bên trái */
    position: relative;
    overflow: hidden;
}

.stat-box:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

/* Phần nội dung chữ */
.stat-content {
    z-index: 2;
}

.stat-title {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 5px;
    letter-spacing: 0.5px;
}

.stat-value {
    font-size: 32px; /* Số to và rõ */
    font-weight: 800;
    line-height: 1.2;
    color: #333;
}

/* Phần Icon */
.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    opacity: 0.2; /* Làm mờ nền icon */
    transition: opacity 0.3s;
}

.stat-box:hover .stat-icon {
    opacity: 1; /* Icon đậm lên khi hover */
}

/* --- MÀU SẮC RIÊNG CHO TỪNG LOẠI --- */

/* 1. Sản phẩm (Màu xanh dương) */
.box-product { border-left-color: #4e73df; }
.box-product .stat-value { color: #4e73df; }
.box-product .stat-icon { background-color: #4e73df; color: #fff; }

/* 2. Đơn hàng (Màu xanh lá) */
.box-order { border-left-color: #1cc88a; }
.box-order .stat-value { color: #1cc88a; }
.box-order .stat-icon { background-color: #1cc88a; color: #fff; }

/* 3. Danh mục (Màu vàng cam) */
.box-category { border-left-color: #f6c23e; }
.box-category .stat-value { color: #f6c23e; }
.box-category .stat-icon { background-color: #f6c23e; color: #fff; }

/* 4. User (Màu xanh ngọc) */
.box-user { border-left-color: #36b9cc; }
.box-user .stat-value { color: #36b9cc; }
.box-user .stat-icon { background-color: #36b9cc; color: #fff; }

/* Trang trí tiêu đề biểu đồ */
h4 {
    font-weight: 700;
    color: #444;
    margin-top: 20px;
    margin-bottom: 20px;
    border-left: 5px solid #4e73df;
    padding-left: 15px;
}
</style>